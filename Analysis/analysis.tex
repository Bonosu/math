\documentclass[11pt,a4paper]{ujreport} 	% for uplatex
%
\usepackage{amsmath,amssymb}
\usepackage{bm}
\usepackage{graphicx}
\usepackage{ascmac}
\usepackage{float}
%
\setlength{\textheight}{40\baselineskip}
\addtolength{\textheight}{\topskip}
\setlength{\voffset}{-0.2in}
\setlength{\topmargin}{0pt}
\setlength{\headheight}{0pt}
\setlength{\headsep}{0pt}

\setlength{\textwidth}{\paperwidth}     % ひとまず紙面を本文領域に
\setlength{\oddsidemargin}{-5.4truemm}  % 左の余白を20mm(=1inch-5.4mm)に
\setlength{\evensidemargin}{-5.4truemm} % 
\addtolength{\textwidth}{-40truemm}     % 右の余白も20mmに
%
\newcommand{\divergence}{\mathrm{div}\,}  %ダイバージェンス
\newcommand{\grad}{\mathrm{grad}\,}  %グラディエント
\newcommand{\rot}{\mathrm{rot}\,}  %ローテーション
%
\title{脳波解析のための数学シリーズ\\
 解析編}
\author{後藤 優仁}
\date{\today}
\begin{document}
\maketitle
%
%
\tableofcontents
\newpage

\section{はじめに}

さて, 基礎を学んだところで, ここからはいよいよ理工系の学生, 脳というブラックボックスに挑む学生として学ぶべき, 高度(?)な数学に挑戦していきます.\\ 
　わくわくしますね！！！\\
　この書を理解する事が出来れば，脳波解析の基本は抑えられたといっても過言ではあるけどまあ一般の修士程度の知識はつけられると思います．
\chapter{フーリエ変換}
この章では脳波解析の初歩というか基本．フーリエ変換を学習していきます．基本中の基本というか，これがないと何も解析ができないので頑張りましょう．と言っても，材料は既にbasicの方で抑えてあるのであとはじゃんじゃん動かすだけです．
\section{オイラーの公式}
まずはオイラーの公式の導出からいきましょう！！！\\
\\
　今まで, 証明をずっと後回しにしてたくせによく使っていた理由は, まずこの公式の導出には様々な数学的知識が必要であることです. また, やや直感的に分かりにくい公式であるため, 導出より先にその利便性, 利用のされかたに触れて慣れてほしかったのです.\\
\\
改めて, オイラーの公式を眺めてみましょう.\\
\begin{eqnarray}
\mathrm{e}^{i\theta} = \cos\theta + i\sin\theta
\end{eqnarray}

しっかりと理解するため，まずはこいつをちょっと解剖してみましょう. 数学語を日本語に翻訳すると, おそらくこんな感じになります.
\\
\\
　指数関数 $\mathrm{e}^x$のxに角度$\theta$を代入し, 虚数単位$i$をかけたもの(左辺)が, $sin$ と $cos$ の足し算で表した何らかの値と同じ値を表している.\\
\\
　うーん謎ですね.\\
　なぜ指数関数が三角関数で表せるのか？\\
　三角関数の足し合わせってなんだよ？\\
　指数関数を虚数にするってなんだよ？？\\
\\
　これらの疑問を解消するため，少しずつ見ていきましょう．
\subsection{マクローリン展開}
さて, 一旦オイラーの公式は忘れてみましょう.\\
\\
　大学で学ぶ数学, とりわけ微分積分において最初に我々が躓く単元に, テイラー展開・マクローリン展開がありますね！\\
\\
　オイラーの公式は, このマクローリン展開さえ分かれば一瞬で導出する事が可能です.\\
\\
　はじめに，テイラー展開とマクローリン展開の違いは, テイラー展開の限定された特殊形がマクローリン展開です. なのでマクローリン展開だけここでは扱います.\\
\begin{eqnarray}
f(x) = \sum_{k=0}^\infty f^{(k)} (0) \frac{x^k}{k!} = f(0) + f'(0)x + \frac{f''(0)}{2!}x^2 + \frac{f'''(0)}{3!}x^3 ...
\end{eqnarray}

これがマクローリン展開です.\\
　元関数f(x)を多項式で近似するわけですね.\\
\\
　ここで使われる多項式は, 元関数fのx=0の時の高階微分係数から定まっています．\\
\\
　こいつの凄いのは, 局所的なある一点での振る舞いだけをみれば元の関数がわかるって事です！！\\
　テイラー展開とは, この時のxの値が0じゃなくてどこでもいいってやつで, マクローリン展開はx=0に限ったやつの事です.\\
\\
　$x=0$の時に最も元関数っぽい一次関数, 二次関数, 三次関数...と$\infty$に足し合わす事で元関数を表そうって事です！！！\\
　便利そうですね. 計算はだるいが.\\
\subsection{指数関数と三角関数のマクローリン展開}
さて, ここで指数関数と三角関数(sin, cos)のマクローリン展開を見てみましょう！！\\

\begin{figure}[H]
\label{im:exp}
  \centering
  \includegraphics[width=12cm]{../figures/exp.eps}
  \caption{exp関数のマクローリン展開}
\end{figure}
\begin{figure}[H]
\label{im:sine}
  \centering
  \includegraphics[width=12cm]{../figures/sine.eps}
  \caption{sin関数のマクローリン展開}
\end{figure}

\begin{figure}[H]
\label{im:cosine}
  \centering
  \includegraphics[width=12cm]{../figures/cosine.eps}
  \caption{cos関数のマクローリン展開}
\end{figure}

\begin{eqnarray}
\mathrm{e}^x = \sum_{(k=0)}^\infty \frac{x^k}{x!} = 1 + \frac{x}{1!} + \frac{x^2}{2!} + \frac{x^3}{3!} + ...
\label{eq:sisuu}
\end{eqnarray}

\begin{eqnarray}
\sin x = \sum_{k=0}^{\infty}(-1)^k \frac{x^{2k + 1}}{(2k + 1)!} = \frac{x}{1!} - \frac{x^3}{3!} + \frac{x^5}{5!} - \frac{x^7}{7!} +  ...
\label{eq:sain}
\end{eqnarray}

\begin{eqnarray}
\cos x = \sum_{k=0}^\infty(-1)^k \frac{x^{2k}}{(2k)!} = 1 - \frac{x^2}{2!} + \frac{x^4}{4!} - \frac{x^6}{6!} + ...
\label{eq:cosa}
\end{eqnarray}

勘の良い人なら気付くでしょう．\\
　なんとなくですが, 式(\ref{eq:sain})と式(\ref{eq:cosa})を足すと, 式(\ref{eq:sisuu})っぽいですよね．\\
\\
　気になるので，どうにかいじって等号で結べないか確かめてみます．とりあえず足してみましょう.
\\
\begin{eqnarray}
\mathrm{e}^x = \sum_{(k=0)}^\infty \frac{x^k}{x!} = 1 + \frac{x}{1!} + \frac{x^2}{2!} + \frac{x^3}{3!} + \frac{x^4}{4!} + ...
\end{eqnarray}
\begin{eqnarray}
\sin x + \cos x = 1 + \frac{x}{1!} - \frac{x^2}{2!} - \frac{x^3}{3!} + \frac{x^4}{4!} + ...
\label{eq:mix}
\end{eqnarray}

やはり似ていますね． もうちょっと, あとは符号だけ変えちゃえばいけそうなのですが...\\
　2項ずつ, 符号があってたりあってなかったりしてますね.\\
\\
　これは一寸難しいですね. もし交互に異なるのであれば, 式(\ref{eq:mix})の構成要素のどちらかに -1 をかければ良いのですが, 2項ずつとなるとそうもいきません. かといって両方にマイナスをかけても, 違う形になるし...\\
\\
　しかしよく考えてみましょう．それぞれのはn乗になっています. なんとか乗した時に符号が変わればいいのですから, ここで虚数単位iの導入に目星をつけます．こいつは2乗すると$-1$になるんでしたね．\\
\\
　とりあえず指数の方にやってみましょう.

\begin{align}
\mathrm{e}^{ix} \\
& = \sum_{(k=0)}^\infty \frac{ix^k}{x!} = 1 + \frac{ix}{1!} + \frac{i^2x^2}{2!} + \frac{i^3x^3}{3!} + \frac{i^4x^4}{4!} + ...\\
& = 1 + i\frac{x}{1!} - \frac{x^2}{2!} - \frac{ix^3}{3!} + \frac{x^4}{4!} + ...
\label{eq:eix}
\end{align}

ちょっといい感じですね.\\
　次に, 分母が奇数の時にiが残ってしまっているので, 奇数に対応しているsinの方にもiをかけてみましょう！\\
\begin{eqnarray}
i\sin x = \sum_{k=0}^{\infty}(-1)^k \frac{ix^{2k + 1}}{(2k + 1)!} = \frac{ix}{1!} - \frac{ix^3}{3!} + \frac{ix^5}{5!} - \frac{ix^7}{7!} +  ...
\end{eqnarray}
　問題なさそうですね！改めてcosと足してみます！！\\
\begin{eqnarray}
\cos x + i\sin x = 1 + i\frac{x}{1!} - \frac{x^2}{2!} - \frac{ix^3}{3!} + \frac{x^4}{4!} + ...
\label{eq:cossin}
\end{eqnarray}
　式(\ref{eq:eix})と式(\ref{eq:cossin})を見比べると, 見事に一致しています！！！\\
\\
　これでオイラーの公式の証明がおわりですね．お疲れさまでした．\\
\\
　オイラーの公式とは, 指数関数と三角関数をマクローリン展開した際にでてきた奴らが似ていたので, 虚数を導入してみたらきれいに等号で結べたねって事です.\\

\subsection{オイラーの公式の有用性}
オイラーの公式とは
\begin{eqnarray}
\mathrm{e}^{i\theta} = \cos \theta + i\sin \theta
\end{eqnarray}
でした.\\
\\
　この時, $\theta$に$\pi$を代入すると, 更に美しくなります.
\\
\begin{eqnarray}
\mathrm{e}^{i\pi} = -1 + 0\\
\mathrm{e}^{i\pi} + 1 = 0
\end{eqnarray}
　実際に計算すれば分かりますね. たしかに成り立ちます. \\
　最も基本である数字0と1, そしてネイピア数, 円周率, 虚数...\\
　数学において偉大と言われる奴らが一堂に会して, あっさりとまとまっているのです！！！\\
　ひええええ...！！！\\
\\
　これこそが, オイラーの公式が人類の至宝といわれる所以です．とても綺麗ですね．\\
\\
　オイラーの公式はこのように，三角関数を実数と虚数で足し合わせた極座標表示した時，指数関数に変換できますよというものでした．この性質を使って，次節以降のフーリエ変換が行われます．

\section{フーリエ変換}
　さて, いよいよ本節から実際に我々が脳波と戦う際に用いる技の紹介となっていきます. 基礎 (basic.pdf) が理解できている諸君なら, それほどつまずく事もないはずです. 実際筆者は, これまでの内容の理解に非常に時間をかけましたが, これ以降はそれほど時間をかけずに理解を進める事が出来ました. 基本を忘れなければ大丈夫です．数式はどんどんいかつくなりますが，落ち着いて臨んでください．部分部分は既に知っている数式の組み合わせになっているはずです．
\subsection{脳波とは}
そもそも, 解析方法を考える以前に...\\
　我々は脳波という似非科学チックな香ばしいものと対峙するわけですが, こいつの特性を知らずに武器や魔法を準備するのは非効率ですね. まずは脳波というものがどういったものなのかを考えてみます. \\
\\
　脳波とは, 脳に無数に存在する脳神経細胞が刺激を受け, その総量が閾値を超えた時に発生される電気信号 ... の集合体みたいなものでしたね．分からない人はまずそっちを勉強してきてください．\\
\\
　領域Aに脳細胞が100万個あったとしましょう. \\
　そのうち, 70万個が発火していて, 30万個が沈黙していたとします. 領域A直上にある脳波計の電極は, そこら一帯の電気的活動の総和を観測し, 領域Aで強い活動があったと記すわけです(図\ref{im:topo}).\\
\\
　この時の「強い活動」というのは, 電極で計測された電気信号の振幅, 100万の細胞電位の総和の値です. これが大きい程, 強い活動という解釈がされます.\\

\begin{figure}[H]
\label{im:topo}
  \centering
  \includegraphics[width=8cm]{../figures/topomap.eps}
  \caption{電極で拾われる脳波のイメージ. 近傍電位の総和}
\end{figure}

　しかし, 元来神経細胞の1回の発火は一瞬のものです. 2つの細胞があったとして, それらが数ms間隔で交互に活動しているとしたら, 片方が発火している間にもう片方は負の方向に電位を発しているわけですから, その総和を取ると細胞1個の発火分にも満たない事になります. \\
　これは当然, 数百万単位の細胞が集まった時にも同じ事が言えて, 振幅が小さいからといって脳が活動していない ... という訳ではありません. 単に同期的活動を行っているわけではないという事です.\\
\\
　本来はパルス波っぽい挙動をする神経信号ですが, それらが無数に存在し, 各々のタイミングで活動をしているため, 脳波計の電極によって計測される総和信号は連続的で, 非常に複雑な挙動を取る波となります. \\
\\
　この波を俗に脳波と言い, 振幅が大きい時には強い活動 (正確には同期した活動) が行われていて, 逆に振幅が小さい時には同期していない, つまりばらばらな活動を行っているといった解釈がなされたりします. \\
　しかしこのままでは, 複雑すぎて人間の目で見たら何がどうなっているのか全く分からず, 麻酔科医やてんかんの診断をする超能力医者のようなスーパーマンでもない限り, 「これは○○の脳波だ！」とか言えません. そこで凡人の我々は, どうにかしてこの複雑怪奇な脳波を解釈し, 脳の活動を解明する必要があるわけです.\\

　そこで, 最も基礎となるアプローチが...\\
　複雑すぎて分からないなら, 単純な波に分解してあげればいいじゃん？？\\ 
　というやつです. どんな波も, 直交性をもつ波に分解できるみたいな話題が基礎編にありましたよね？あれを利用します．
\\
　こうして, 複雑極まりない脳波を, 単純で解釈のしやすい三角関数の足し合わせとして表現しよう！というのがフーリエ変換のモチベーションです.\\

\begin{figure}[H]
\label{im:eeg}
  \centering
  \includegraphics[width=12cm]{../figures/eeg.eps}
  \caption{A. 脳波の例 1 ～ 4は周波数帯成分}
\end{figure}

\subsection{フーリエ級数展開}
さて, フーリエ変換をする目的は, 複雑すぎて解釈できない時間関数を単純な関数によって表現する事でした.\\
\\
　複雑な関数でも, 三角関数の足し合わせで表現できるという事は既に確認しましたね. 三角関数の特徴は, その振幅と角周波数だけで定義する事ができます. \\
　角周波数とは, 1sの間にどれだけの角度波が進むかという指標で, 周波数とかから求める事が出来ます. まあ周波数って考えちゃっても大体おｋです. \\
\\
　つまりフーリエ変換とは, 複雑な元関数を単純な三角関数の足し合わせと考え, それぞれの振幅を角周波数毎に求める事をさします.\\
\\
　このうち, 元関数f(t)を単純な三角関数の足し合わせに分解するまでをフーリエ級数展開と言い, 式では以下のようになります. 
\begin{eqnarray}
f(t) = a_0 + \sum_{\omega=1}^\infty {(a_\omega \cos(\omega t) + b_\omega \sin(\omega t))}
\label{eq:fourierkyusu}
\end{eqnarray}

式(\ref{eq:fourierkyusu})の意味はこうです. 「元関数$f(t)$を, 1から$\infty$の角周波数$(\omega)$の$sin, cos$波の足し合わせとして表現する」 そのまんまですね！\\
\\
　ここでの$a$や$b$はその周波数の波の大きさを決める変数で, それぞれの項毎に異なる値を取ります. 要は振幅の事ですね.\\
\subsection{複素フーリエ級数}
しかし, 式(\ref{eq:fourierkyusu})は面倒ですね. なんていったってsinとcosを分けて計算するのがだるすぎます. どうにか綺麗にできないものか...\\
\\
　はい．そこでオイラーの公式を使うわけですね．
\begin{eqnarray}
\mathrm{e}^{i\omega t} = \cos\omega t + i\sin\omega t
\label{eq:normaleuler}
\end{eqnarray}
　いつもは$\pi$のところですが, 今回は空気を読んで角周波数$\omega t$に変形しています. 角周波数に時間をかけてるんだから，その時間$t$の時の角度です．\\
　しかし問題はあれです. オイラーの公式には$i$がありますが, フーリエ級数展開の方には$i$がありません. どうしたことか.\\
\\
　ここで少し裏技というか，オイラーの公式の裏を使います.
\begin{eqnarray}
\mathrm{e}^{-i\omega t} = \cos\omega t - i\sin\omega t
\label{eq:eulerminus}
\end{eqnarray}
　式(\ref{eq:eulerminus})が成り立つのは大丈夫ですね？角度が実軸対称に飛んだら, cos成分は変わりませんがsin成分は符号が反転します. うちの猫でも知ってる事です.\\
\\
　さて, 次に式(\ref{eq:normaleuler})と式(\ref{eq:eulerminus})を連立して解く事で式(\ref{eq:fourierkyusu})のcosとsinを置き換えます. \\
\begin{eqnarray}
f(t) = a_0 + \sum_{\omega=1}^\infty {(a_\omega \frac{\mathrm{e}^{i\omega t}+\mathrm{e}^{-i\omega t}}{2} + b_\omega \frac{\mathrm{e}^{i\omega t} - \mathrm{e}^{-i\omega t}}{2i})}
\label{eq:complexfourier}
\end{eqnarray}
　この式を同類項を抜き出して整理すると
\begin{eqnarray}
f(t) = a_0 + \sum_{\omega=1}^\infty {(\frac{a_\omega - ib_\omega}{2}\mathrm{e}^{i\omega t})} + \sum_{\omega=1}^\infty {(\frac{a_\omega + ib\omega}{2}\mathrm{e}^{-i\omega t})}
\label{eq:complexfourierkai}
\end{eqnarray}
となり, 更に$\mathrm{e}^{-i\omega t}$において$\omega$を1から$\infty$まで足すのと, $\mathrm{e}^{i\omega t}$において$-\infty$から-1まで足すのは同義なため(図を書けばわかる), この3項をうまくくっつける事で
\begin{eqnarray}
f(t) = \sum_{\omega = -\infty}^\infty F_\omega \mathrm{e}^{i\omega t}
\end{eqnarray}
とおけますね！いい感じにまとまりました！！！\\
　あ, 定数部分は面倒なので$F_\omega$とおいてます. \\
\\
　ここまでがフーリエ級数展開でした．フーリエ変換とは, この係数たちを求める作業のことを指します. 
\subsection{フーリエ変換} 
　実際に式を見てみましょう.\\
\begin{eqnarray}
F(\omega) = \int_{-\infty}^{\infty} f(t)\mathrm{e}^{-i\omega t} dt
\label{eq:furier}
\end{eqnarray}

です. さっそく式(\ref{eq:furier})を解読してみましょう. 大丈夫. 基礎がしっかりできている人なら自ずと理解できるはずです.\\
\\
　まず, eの肩に $ -i\omega t $ が載っていますね. この形はどこかで見た事があります. そう, オイラーの公式ですね！！\\
　オイラーの公式にマイナスをかけたやつです. つまり $ \cos\omega t  - i\sin\omega t $ ですね. \\
　なので式(\ref{eq:furier})は以下の式に変形できそうです.\\
\begin{eqnarray}
F(\omega) = \int_{-\infty}^{\infty} f(t)(\cos\omega t - i\sin\omega t) dt
\label{eq:furierkai}
\end{eqnarray}
　結構読めてきたんじゃないですかね.\\
　分配法則が分からない輩のために, 更に式(\ref{eq:furierkai})を変形します.\\
\begin{eqnarray}
F(\omega) = \int_{-\infty}^{\infty} f(t)(\cos\omega t) - f(t)(i\sin\omega t) dt
\label{eq:furierkaikai}
\end{eqnarray}
　もう完璧ですね. ここまで解してあげれば赤ちゃんでも噛み砕けそうです！！噛み砕けない人は乳歯が生えていないのでしょう. かわいそうに...乳歯の生えていない人はまずbasic.pdfで離乳食を食べてきてください．\\
\\
　さて, 式(\ref{eq:furierkaikai})を日本語にしてみましょうか.\\
　まず, 時間(t)における元関数(ここでは, ある電極で取れた脳波ですね)と, 角周波数($\omega$)のcos, sin成分それぞれとの内積を取っています. 
\\
　フーリエ変換において求めたい係数とは, 「元関数がその角周波数($\omega$)の三角関数に如何に似てるか」の指標です. そして関数の類似度の指標は内積で表せるんでしたね．一応，確認をしておきましょうか．\\
\\
　Tips.\\
　まずは，関数の内積を考えたときのように，イメージのしやすいベクトルで考えてみましょう．ベクトルの分解の場合には，係数を考えるのはとても簡単ですね．\\
\begin{eqnarray}
\left( \begin{array}{cc} 5\\ 3\\ \end{array} \right) = \alpha \left(\begin{array}{cc} 1\\ 0\\ \end{array} \right) + \beta \left( \begin{array}{cc} 0\\ 1\\ \end{array} \right)
\label{eq:vector}
\end{eqnarray}

この時の$\alpha$と$\beta$の値を求めよ．簡単ですね．$\alpha = 5$, $\beta = 3$とすぐに解けると思います．\\
　ただまあ，こうやって感覚じゃなくて計算で求める場合には，下の式(\ref{eq:vector_right})のようにする必要があります．
\begin{eqnarray}
\alpha = \left(\begin{array}{cc} 5\\ 3\\ \end{array} \right)\left(\begin{array}{cc} 1\\ 0\\ \end{array} \right) = 5+0=5 \nonumber \\
\beta =  \left(\begin{array}{cc} 5\\ 3\\ \end{array} \right)\left(\begin{array}{cc} 0\\ 1\\ \end{array} \right) =0+3=3
\label{eq:vector_right}
\end{eqnarray}
　そう，内積です．ベクトルを直行成分に分解する際，係数を求めるには元のベクトルと分解先の「直行成分」との内積を求める訳です．\\
　これを，例によって関数に拡張します．そうすると式(\ref{eq:furier})もさらに読めるのではないでしょうか．\\
\\
　尚，面倒なので式の表記はやっぱりオイラーで表しておきます．そう，フーリエ変換の式(\ref{eq:furier})はまさに，元関数f(t)と複素指数関数との内積を計算することで，複素指数関数の係数，すなわち三角関数の大きさを産出してるわけですね！\\

次に, sin成分が負($\mathrm{e}^{-i\omega t}$)になっている理由です. 内積とは「似ている度」の指標ですね. 普通の数字やベクトルでしたら正の値になりますが, 今回のように虚数や複素数の場合は内積の結果が複素数の形をとってしまう事になります(虚数とはそういうものでしたね？).\\
\\
　それだと解釈に困ります．うざい．どうにかして虚数成分は消えた感じの結果が欲しいわけです. 虚数成分を消す...共役複素数を使えばいいですね！！！\\
\\
　実際, 自分自身との内積の正しい定義は「共役複素数をかける」です. 今までは実数で考えていたので, 気にする事はありませんでしたが複素数の場合はこの方法に則る必要があります.\\
　すなわちこうです．
\begin{eqnarray}
a = \left(\begin{array}{cc}3\\ -5i\\ 2+3i\\ \end{array} \right) \nonumber \\
(a \cdot a = )a \cdot \overline{a} = \left(\begin{array}{cc}3\\ -5i\\ 2+3i\\ \end{array} \right)\left(\begin{array}{cc}3\\ 5i\\ 2-3i \end{array} \right) = 9 + 5 + 13= 27
\label{eq:naiseki}
\end{eqnarray}
　式(\ref{eq:naiseki})の第一成分のように虚数成分を含まない場合には単純な掛け算でしたが，第二成分のように虚数成分がある場合には正負を反転させます．第三成分のような複素数の場合は虚数成分だけ反転です．\\
\\
　つまり，今までやってた内積の計算方法はたまたま虚数成分がないからそのままかけてただけで，一般的な定義はこちらということですね．
\\
　これにより, ある角周波数成分 $\mathrm{e}^{i\omega t}$と元関数f(t)の内積を求める際に$\mathrm{e}^{-i\omega t}$を用いるわけです. まあ, やってるのは普通に内積です.\\
\\
\\
　内積とは, 「どれだけ似ているか」の指標でしたね. つまりここで, 元関数は角周波数($\omega$)の三角関数とどれだけ似ているかを見ているわけです！！\\\\
　そしてその結果を $-\infty$ から$\infty$ までの範囲で積分 ... 足し算しています.\\\\
　この値がF($\omega$)らしいですね. さて, こいつはどういった条件でどういった値を取るかというと, 元関数の中に角周波数($\omega$)の成分が多ければ多い程, 内積の値は1に近くなります. \\
　という事はその総和も大きくなります. 逆に値が小さいという事は内積の値も小さい ... つまり元関数の中に角周波数($\omega$)の成分は少ないという事になりますね！！\\
\\
　こうして, 複雑怪奇な時間関数を周波数関数に変換（というか見方を変える）事によって, より解釈のしやすい形に変換するのがフーリエ変換の強みです.\\
\\
　実際にはF(ω)のうち, 「$x_1Hz$は成分が大きくて, $x_2Hz$は成分が小さいね」といった事が分かるようになるわけです.
\subsection{フーリエ変換の実用}
実際には, 式(\ref{eq:furier})によって無限の周波数成分を抜き出し, それぞれの振幅を求める事で, 「元関数$(t)$はそれぞれの周波数をそれぞれの振幅倍した$sin$波の足し合わせで出来てるね！」などと解釈します.\\\\
　例えば, 「タスク1をやらせた時の被験者君は5 -- 7Hzくらいの脳波がよくでているね！」「タスク2の時には大して強くないね。てことはタスク1と5 --7Hzの脳波には何か関係がありそうだね！！」といった具合です. 論文にもそのまんま書かれています.
\\\\
　人はこれを周波数分解といい, これを使った解析が周波数解析だとかスペクトル解析と呼ばれる種々の解析になります！！（上の「」に入ってるのも周波数解析による解釈)\\

\begin{figure}[H]
  \centering
  \includegraphics[width=15cm]{../figures/fourier.eps}
  \caption{三角関数を足し合わせて作った関数(左)へのフーリエ変換と，そこにノイズを加えた信号へのフーリエ変換．視覚的に壊れていても，若干影響は受けるがしっかり周波数成分に分解する事が出来ている．なお，よく見ると負の周波数も出ている事が分かると思うが，これはフーリエ変換がマイナス無限から無限の周波数に分解するため．実用では負の周波数は無視して良い．}
\end{figure}

真面目に信号処理，というかフーリエ変換を勉強しようと思った場合にはだいぶ飛ばしちゃってるのでだめなところも多いかと思いますが，筆者的には脳波解析で使うだけの人はこんなくらいでも良いのかなと思います．もし気になったり，不満だったりする人は教科書をあたってみてください．
\chapter{wavelet 変換}
\section{フーリエ変換の弱点と定常性}
万能に思えるフーリエ変換ですが, 実は脳波を解析しようと思うと弱点があります．結論から言うなれば，まず一つ目は「元関数$f(t)$に定常性を仮定してしまっている」事です．関数の定常性とは，平均や自己共分散が時間に陽に依存していない，同じ時点数ならどこで切っても同じ形になってる，的な特徴を指します．簡単に言えば，どれだけ時間が経っても同じ関数の形を保っているということです(厳密には違うけどとりあえずはそう理解していて良いです)．以下が(強い)定常性を満たす関数の例です．
\begin{eqnarray}
y = 3\\
y = sinx
\end{eqnarray}
　そりゃそう，ですね．どちらも先の定義を満たしているのがわかるかと思います．三角関数は周期性を持った関数なので，当然定常性を満たすことになります．\\ \\

\begin{figure}[H]
  \label{im:stat1}
  \centering
  \includegraphics[width=15cm]{../figures/stationarity1.eps}
  \caption{いろんな三角関数とその足し合わせ．どれも定常性もってる}
\end{figure}
　さて，ここで問題なのがフーリエ変換の方針です．「すべての関数は，無限の複素サイン波の足し合わせで表現することができる」でしたが，これはより正確には「すべての（定常性をもつ）関数は〜」です．\\ \\
　何故なら，周期関数であるサイン波との積は，元関数が同様に周期性を持つ，定常性をもつ関数でない場合にはどのタイミングで内積を求めるかによって値が変わってしまいます．\\
\\ 
　これはとても困る．\\
　元関数の性質を内積によって圧縮しているのに，どのタイミングで計算するかによって値が変わるんじゃ話になりませんよね．\\
　なのでフーリエ変換をする際には，元関数f(t)に定常性を仮定する必要があります．時間に依存した関数ではない，とすることです．\\
\\
　逆に言うと，定常性を満たさない関数に対しフーリエ変換は使えません．計算が出来ない訳じゃないけど，正しい分析をすることが出来ません．役立たずです．\\
\\
\\
　勘の良い読者諸君ならお気づきだろうが（物理の本でよく見るコレ，一度言ってみたかった），これでは脳波の解析に使えなさそうじゃないですか？使えないですよね？\\
\\
　え？なんでそうなるのって？え，なに，お前の脳波は飯食ってる時も寝てる時も数学やってる時もずっと同じなん？\\ \\
　きっしょ．\\
\\
　普通，脳波はずっと同じなんてことはないですよね．脳が体を操作したり感覚の処理を行なっているとする我々の立場が本当に正しいのであれば，脳という処理系は入力の値によってその振る舞いを変えるし，同様に出力を出すためにも振る舞いを変えるはずです．そもそも我々脳波系研究者はその大前提の元にいろんなタスクをやらせて反応を見ていますよね．

そう，脳波は定常性を持っていないのです．困った．フーリエ変換は使えないじゃないか．なんのために苦労してフーリエ変換やったと思ってるんだ馬鹿野郎．時間返せ．

\begin{figure}[H]
  \centering
  \includegraphics[width=15cm]{../figures/stationarity2.eps}
  \caption{図(\ref{im:stat1})にノイズを加えた結果定常性が下がった奴ら．おまけに時間発展するsine波}
\end{figure}

二つ目，一つ目に含まれているようなものですがあえて分けて言及すると，フーリエ変換はマイナス無限から無限の積分をしています．実験中の○○をしている時の脳波，それも反応した直後の数百msの間だけ，なんて議論には使えないのですね．この意味でも無意味です．実験に限るのであれば，計測した全ての脳波に対して周波数特性をだすことになってしまいます．わけわからんですね．使えない．

\section{窓付き，短時間フーリエ変換}
しかし，逆に考えるとそもそもそんなガチな定常性を持った関数の方が自然には少ないだろうし，そもそも無限時間の積分とかできる訳ないだろって感じだし，そのまんまのフーリエ変換が厳しすぎるだけな気もします．どうにかもう少し現実的な妥協案を考えましょう．ということで考案されたのが，窓付フーリエ変換だとか短時間フーリエ変換だとか言うやつらです．\\
\\
　ざっくりと説明しましょう．賢い人達の用意した言い訳はこうです．\\
「確かに無限時間なら定常性がないけど，短い時間の中では？その中では定常性を持ってるぽく振る舞うことは十分にあるよね？」\\
　うーん，たしかに？厳密さにかけるし，”短い時間”ってどれくらいよって感じだし，それでもダメっぽい可能性もあるっしょだったり，色々と文句はありますが，まあこういうことです．\\
\\
　ということで，元関数f(t)をぶつ切りにしていきます．ぶつ切りにした範囲内ではそうそう変な変化とかしないと仮定して，そのなかでフーリエ変換をします．\\

\begin{figure}[H]
  \label{im:dft1}
  \centering
  \includegraphics[width=15cm]{../figures/dft1.eps}
  \caption{細切れにしていくイメージ}
\end{figure}


図(\ref{im:dft1})では，脳波を見立てててきとうに作成した信号を5つの時間窓に分けています．この場合，この長い時間窓に対してフーリエ変換をした場合は一通りの周波数特性しか計算できず，その間の被験者の脳活動は一定(つまり何か同じ処理をしていた)であったという仮定の元計算する事になってしまいます．しかし5分割すると，活動が一定であったと仮定するのはこの短い窓の中だけで済むわけですね．実際はこれをもっともっと細かくしていくイメージです．

　ただここで問題です．ただただ元関数を切り取るだけで良いのかというとそうではありません．だって連続的な値をとる波なのに無理やり途中で切られたら，断面が変な形になってしまいますよね．一瞬でがくっと切り替わる超超超高周波成分なのかな？みたいに解釈されてしまいます．\\
　それに，そもそもフーリエ変換って時間を無限に積分してましたけど，こうやって窓をぶつって切った場合は積分範囲が指定されることになってしまいますよね．そこまで壊すのも難しいです．あくまで無限範囲の積分という形は保ちましょう．
\\
　そこで，どうにかして切り取った「窓」の両脇の影響は減衰させていく必要が出てきます．どうするか．影響を減らすためには，単純に端に行くにつれて波を小さくしていけばいいですね．窓の真ん中が一番影響が乗り，端に行くほど影響が小さくなる，いわゆる山形の信号に整形してやれば良い訳です．この山がちょうど切り取った窓の長さに収まる形にしてあげれば，窓の外なんかは実質0の値を取るわけだから，無限の積分は出来るけど窓の外の範囲からの影響は受けない，という先程の要求を満たすことが出来ます．\\


\begin{figure}[H]
  \label{im:dft2}
  \centering
  \includegraphics[width=15cm]{../figures/dft2.eps}
  \caption{ガウス窓によって減衰させた図(\ref{im:dft1})}
\end{figure}

今回の図(\ref{im:dft1})の例だと，定常性を持っていない信号だとしても短い窓の間は定常性があるっぽく仮定して，1つの信号としてフーリエ変換するのではなく5区間で変化していく信号としてフーリエ変換したわけですね．こうすることで疑似的に，周波数スペクトルの時間変化を見る事が出来るわけです．便利ですね．こうした，周波数の時間変化を見ていく解析を時間周波数解析と称します．\\

山形に窓を整形するために，元信号にかけるフィルタのような働きをする関数を，窓関数と言います．よく用いられるのはガウス関数(\ref{im:gauss-window})です．形綺麗だしね．

\begin{figure}[H]
  \label{im:gauss-window}
  \centering
  \includegraphics[width=8cm]{../figures/gauss-window.eps}
  \caption{図(\ref{im:dft2})の出力に使ったガウス窓．幅はsegmentと同じ}
\end{figure}

がしかし，今度はこうした窓を作成する事によって別の問題が生じます．窓をどこでどう区切るかで差が出てしまいそうだし，そもそも連続的に見たいというモチベがあったはずなのに1つが5つに増えただけじゃ根本的には解決してないですよね．\\

なので，この窓を今回でいう1--200, 201--400,...なんて区切り方をするのではなく，スライドさせていく事を考えます．つまりデータ点1を中心としたガウス窓にかけ，次にデータ点2を中心とした窓にかけ...と計算したいきます．つまりは畳み込みですね．
というわけで，短時間フーリエ変換の式は以下のようになります．

\begin{eqnarray}
STFT_{f,w}(t, \omega) =X(\omega)= \int_{-\infty}^{\infty} f(\tau)w(\tau - t)\mathrm{e}^{-i\omega \tau} d\tau
\label{eq:stft}
\end{eqnarray}

ここで$f(t)$は元関数，$w(t)$は窓関数であり，元関数と窓関数を畳みこんだ信号と複素サインの内積をとっているわけですね．
　んで，よく使われる窓関数はガウス関数なので，その場合の式はこんな感じ(式\ref{eq:stft_gauss})になるのかな？

\begin{eqnarray}
STFT_{f,w}(t, \omega) = X(\omega) = \int_{-\infty}^{\infty} f(\tau) \frac{1}{\sqrt{2\pi\sigma^2}}e^{-\frac{{(\tau-t)}^2}{2\sigma^2}}\mathrm{e}^{-i\omega t} d\tau
\label{eq:stft_gauss}
\end{eqnarray}

整理すると，短時間フーリエ変換は元信号に窓関数をかけて整形したデータをフーリエ変換にかける事でした．\\

\begin{figure}[H]
  \label{im:tft}
  \centering
  \includegraphics[width=15cm]{../figures/tft.eps}
  \caption{てきとうに作った上の信号に対する，短時間フーリエを使った時間周波数解析．左は割と低周波，右は高周波．上が元信号で下が時間周波数解析のプロット．なんか思った以上に露骨に悪いとこでてるんだけど...うーん？}
\end{figure}

　がしかし，これでもまだ，というか新しい問題が発生してしまいます．図(\ref{im:tft})を見れば分かりそうなものですが，とにかくその問題を解決するために使えるのが，次以降説明するウェーブレット変換です．

ちなみに補正された良い感じのはこうなります．

\begin{figure}[H]
  \label{im:tft2}
  \centering
  \includegraphics[width=15cm]{../figures/tft2.eps}
  \caption{てきとうに作った上の信号に対する，???を使った(今からやるよ)時間周波数解析．左は割と低周波，右は高周波．上が元信号で下が時間周波数解析のプロット．図\ref{im:tft}の悪いところを直した感じのやつ}
\end{figure}

\section{不確定性原理}
さて，短時間フーリエ変換の何が問題になっているのかというと，元信号に窓関数をかけてしまっている事です．これにより，どの周波数帯域のデータを見るにしても同じ時間窓を利用する事になっているので，時間窓長は一定で，カーネル(複素サイン)の角周波数$\omega$を変数とする事になります．\\
\\
　ここで問題になるのが，周波数分解能と時間分解能のトレードオフ，不確定性原理です．\\
\\
　つまり，高周波になるほど時間分解能が上がり周波数分解能が下がる，低周波になるほど時間分解能が下がり周波数分解能が上がる，という現象です．\\
\\
　ちょっと想像すればわかります．人間の脳も同じですから．1Hzの振動と2Hzの振動を区別するのは容易ですよね？1秒に1回殴られるのと1秒に2回殴られるのは大きく違います．これが周波数分解能が高い状態です！\\\\
　でもお前らみたいな陰キャはやっぱいじめられっ子なので，殴られる回数もそんなもんじゃないでしょう．きっと秒間100発とか殴られてるはずです．かわいそうに．そんなお前らにとっては，秒間100発殴られるのも101発殴られるのも変わらないよね．これが周波数分解能が低い状態．\\
\\
　時間分解能については，時間をどれだけ区切って考えられるかなので高周波ほど高いのは自明ですね．\\
\\
　さて，分解能について理解したところで短時間フーリエに戻りましょう．先ほど確認したように，短時間フーリエでは「元関数に窓関数をかけて，それを変数$\omega$のフーリエ変換にかける」訳でしたね？\\
\\
　こうすると，どんな周波数と内積を取る時も窓の長さは常に一定です．もうわかりましたね．\\
\\
　そう，短時間フーリエでは低周波と高周波でそれぞれ時間と周波数の分解能の良し悪しが反転してしまっている(図\ref{im:furiers})のです．低周波ほど信号のタイミングが掴みにくくなるし，高周波ほど周波数の違いが分からなくなってくる．困る．同じスケールで議論ができないのはクソです．

\begin{figure}[H]
\label{im:furiers}
 \centering
 \includegraphics[width=15cm]{../figures/uncertainty.eps}
 \caption{短時間フーリエの時空間分解能．時間をあげれば空間が，空間をあげれば時間の分解能が下がる不確定性原理の問題がある．}
\end{figure}


\subsection{Wavelet変換}
　この問題を解決するためにはどうするか．簡単ですね．周波数に依存して窓の長さが変えられるようになれば良い訳です．つまり高周波を見たい時にはカーネルが短く，低周波を見たい時には長くなればいいわけです．\\

%\begin{figure}[H]
%\label{im:wavelets}
 % \centering
 % \includegraphics[width=100mm,bb=0 0 600 300]{../figures/wavelets.png}
 % \caption{waveletのイメージ．周波数によって窓の長さが違う，波の数は同じ}
%\end{figure}

こうすると（どうやるのかはさておき)，周波数によって窓の長さが違うので，いれられる波の数も同じ＝時間分解能や周波数分解能が同じ（っぽい）ように計算ができます．これがWavelet変換のモチベです．\\
\\
　基本的な方針はフーリエと変わらず，元関数とカーネルとの内積によって周波数成分を抜き出す積分変換です．ウェーブレット変換の基本形は以下です．\\

\begin{eqnarray}
W_\psi[f(t)]  = T(a,b) = \int_{-\infty}^{\infty} f(t)\psi_{a,b}(t) dt
\label{eq:wavelet_transform}
\end{eqnarray}

ここで用いるカーネル$\psi_{a,b}(t)$が(マザー)ウェーブレットです．フーリエ変換の時は複素サインでしたね．ウェーブレット変換とは，カーネルにウェーブレットを利用する事によって不確定性原理の壁を乗り越えようというものです．\\
\\
　そのウェーブレット変換ですが，カーネルに用いる関数の事をマザーウェーブレットと言います．そんなマザーウェーブレット$\psi$を，良い感じに調整して作るのがウェーブレットです．式(\ref{eq:wavelet})はマザーウェーブレット$\psi$からウェーブレットを作る公式．

\begin{eqnarray}
\psi_{a,b}(t)  = \frac{1}{\sqrt{a}}\psi(\frac{t-b}{a})
\label{eq:wavelet}
\end{eqnarray}

aとbが変数で，こいつらを変調させていく事でいろんなウェーブレットを作成し，そいつと元関数との内積を見ていくのがウェーブレット変換です．この変数について考えていきましょうか．\\
\\
　まず簡単なのはbの方ですね，時間tを調整している訳だから，単純にウェーブレットの位置を動かしてくれます．シフトと言います．つまり元関数のうちどの時間について変換をするかという事です．高校数学で二次関数のグラフを横移動させたときのアレに似てます．\\
\\
　次はaです．スケールと言います．aの値を変える事で，窓の幅が変わります．割り算してるしね．aが大きいほど窓は広く，aが小さいほど狭くなります．$\sqrt{a}$はスケーリングに対して，つまり窓幅に対してエネルギーが一定になるように調整しているだけ．本質は分数のとこにあります．\\
\\
　さて，ここで勘の良い読者ならお気づきでしょう．マザーウェーブレットを変形させて作るのがウェーブレットという事でした．そう．つまりウェーブレット変換における変数はスケールとシフトのa,bなのです！！\\
\\
　フーリエ変換の変数は角周波数$\omega$でしたが，ウェーブレットにおいてはスケールとシフトなのです．もっというと，周波数$\omega$は定数として扱われます．つまり色んな周波数に対して内積を見ていくのではないという事．この点がウェーブレットが不確定性原理に打ち勝てる秘訣です．\\
\\
　問題は，そうするとどうやって周波数の区別をするんだという事になります．そこで先ほどの変数a(スケール)の存在意義がわかってきます．図(\ref{im:wavelets})から見て取れるように，窓の長さを変える事によって中の波の周波数も変わっています．これによって周波数の差を表現しているわけですね！！\\
\\
短時間フーリエ変換とは，時間窓長を固定し角周波数を変える積分変換．\\
ウェーブレット変換とは，各周波数を固定し時間窓長（全体スケール）を変える積分変換．\\
\\
というわけですね！！違いが分かったでしょうか！！え？分からない！？分かれよぼけ！！！\\

\subsection{Morlet Wavelet}
さて，ウェーブレット変換の概要をつかめたところで，実際に用いられるマザーウェーブレットについて考えていきます．色んな奴がいますが，ここでは脳波解析でよく使われている Morlet Waveletについて解説します．\\
\\
　こいつは非常に単純．今の皆さんならすぐにわかるはずです．なんていったって複素サインにガウスをかけた奴ですから．式は以下(\ref{eq:morlet_wavelet})です．

\begin{eqnarray}
\psi(t) = \frac{1}{\sqrt{2\pi\sigma^2}}e^{-\frac{t^2}{2\sigma^2}}\mathrm{e}^{-i\omega_0 t} dt
\label{eq:morlet_wavelet}
\end{eqnarray}

ね？\\
　もうみんななら分かるはず．ガウス窓付き短時間フーリエと同じノリです．これを使ったウェーブレット変換が以下(\ref{eq:morlet_wavelet_trans})になります．

\begin{eqnarray}
T(a,b) =  \int_{-\infty}^{\infty} f(t) \frac{1}{\sqrt{2\pi\sigma^2}}e^{-\frac{(\frac{t-b}{a})^2}{2\sigma^2}}\mathrm{e}^{-i\omega_0 (\frac{t-b}{a})} dt
\label{eq:morlet_wavelet_trans}
\end{eqnarray}

ほとんどガウス窓付き短時間フーリエと同じですね！並べてみましょう．
\\\\
　短時間フーリエ変換.
\begin{eqnarray}
STFT_{f,w}(t, \omega) = X(\omega) = \int_{-\infty}^{\infty} f(t) \frac{1}{\sqrt{2\pi\sigma^2}}e^{-\frac{t^2}{2\sigma^2}}\mathrm{e}^{-i\omega t} dt
\end{eqnarray}


Morlet Wavelet変換．


\begin{eqnarray}
W_\psi[f(t)] = T(a,b) =  \int_{-\infty}^{\infty} f(t) \frac{1}{\sqrt{2\pi\sigma^2}}e^{-\frac{(\frac{t-b}{a})^2}{2\sigma^2}}\mathrm{e}^{-i\omega_0 (\frac{t-b}{a})} dt
\end{eqnarray}

とても似ていますね．\\
　ちがっているのは，短時間フーリエは時間(窓長)を固定していて変数$\omega$の関数として記述されるのに対し，ウェーブレット変換は周波数を表す$\omega$は定数$\omega_0$で固定されスケールがaとbの変数によって調整されるaとbの関数として記述されている点です！！\\
\\
　他にも，ガウス窓付き短時間フーリエの方は元信号にガウスをかけてから複素サインと内積を取ってる一方でMorlet Waveletは複素サインにガウスをかけてから元信号との内積を取っているなどといった違いもあります．

\section{時間周波数解析の解釈}
フーリエやウェーブレットの結果から，power,frequency,phaseをとりだす方法について書くぞい
\\
\\
\\
(2021.06.16 何が書くぞいじゃ，書いてねえじゃねえかボケ．今度暇みつけて書きます)

\end{document}