\documentclass[11pt,a4paper]{jreport}
%
\usepackage{amsmath,amssymb}
\usepackage{bm}
\usepackage{graphicx}
\usepackage{ascmac}
\usepackage{float}
%
\setlength{\textheight}{40\baselineskip}
\addtolength{\textheight}{\topskip}
\setlength{\voffset}{-0.2in}
\setlength{\topmargin}{0pt}
\setlength{\headheight}{0pt}
\setlength{\headsep}{0pt}

\setlength{\textwidth}{\paperwidth}     % ひとまず紙面を本文領域に
\setlength{\oddsidemargin}{-5.4truemm}  % 左の余白を20mm(=1inch-5.4mm)に
\setlength{\evensidemargin}{-5.4truemm} % 
\addtolength{\textwidth}{-40truemm}     % 右の余白も20mmに
%
\newcommand{\divergence}{\mathrm{div}\,}  %ダイバージェンス
\newcommand{\grad}{\mathrm{grad}\,}  %グラディエント
\newcommand{\rot}{\mathrm{rot}\,}  %ローテーション
%
\title{脳を学ぶ上で重要な数学シリーズ}
\author{後藤 優仁}
\date{\today}
\begin{document}
\maketitle
%
%
\tableofcontents


\chapter{応用数学}
さて, 基礎を学んだところで, ここからはいよいよ理工系の学生, 脳というブラックボックスに挑む学生として学ぶべき, 高度な数学に挑戦していきます.\\ 
わくわくしますね！！！\\
\section{オイラーの公式 \label{euler}}
まずはオイラーの公式の導出からいきましょう！！！\\
\\
今まで, 証明をずっと後回しにしてたくせによく使っていた理由は, まずこの公式の導出には様々な数学的知識が必要であることです. また, やや直感的に分かりにくい公式であるため, 導出より先にその利便性, 利用のされかたに触れて慣れてほしかったのです.\\

\subsection{オイラーの公式を翻訳する}
改めて, オイラーの公式を眺めてみましょう.\\
\begin{eqnarray}
\mathrm{e}^{i\theta} = \cos x + i\sin y
\end{eqnarray}
うーん, 美しいですね.\\
\\
こいつをちょっと解剖してみましょう. 数学語を日本語に翻訳すると, おそらくこんな感じになります.
\\
\\
底をネイピア数eとし, 指数関数 $\mathrm{e}^x$のxに角度Θを代入し, 虚数単位iをかけたもの(左辺)が, sin と cos の足し算で表した何らかの値と同じ値を表している.\\
\\
うーん謎ですね.\\
なぜ指数関数が三角関数で表せるのか？\\
三角関数の足し合わせってなんだよ？\\
指数関数を虚数にするってなんだよ？？\\
\\
\\
私はここで脳がオーバーヒートを起こし, 拒絶反応を起こしたものです.\\
\\
指数関数が三角関数で表せるのは, オイラーの公式が成り立つ事が分かったからだ. つまりは結果論でとらえていいでしょう.(いやまぁ, 本当は違うけども) \\
三角関数の足し合わせとは, 複素数の事だ！！(つまり cos と isin です)\\
\\
どうしても分からないのは無視しよう！！！\\
\\
というのも, オイラーの公式は偶然発見されたと考えた方が気が楽になるのです. 厳密に理解するのは難しい.\\
\\
\\
理解が進めば, おのずと脳に適用されます.
\subsection{マクローリン展開}
さて, 一旦オイラーの公式は忘れてみましょう.\\
\\
大学で学ぶ数学, とりわけ微分積分において最初に我々が躓く単元に, テイラー展開・マクローリン展開がありますね！\\
\\
オイラーの公式は, このマクローリン展開さえ分かれば一瞬で導出する事が可能です.\\
\\
テイラー展開とマクローリン展開の違いは, テイラー展開の限定された特殊形がマクローリン展開です. なのでマクローリン展開だけここでは扱います.\\
\begin{eqnarray}
f(x) = \sum_{k=0}^\infty f^{(k)} (0) \frac{x^k}{k!} = f(0) + f'(0)x + \frac{f''(0)}{2!}x^2 + \frac{f'''(0)}{3!}x^3 ...
\end{eqnarray}

これがマクローリン展開です.\\
元関数f(x)を多項式で近似するわけですね.\\
\\
そしてここで使われる多項式が, fのx=0の時の高階微分係数から定まっているわけです！！！\\
\\
こいつの凄いのは, 局所的なある一点での振る舞いだけをみれば元の関数がわかるって事ですね！！！\\
テイラー展開とは, この時のxの値が0じゃなくてどこでもいいってやつで, マクローリン展開はx=0に限ったやつの事です.\\
\\
x=0の時に最も元関数っぽい一次関数, 二次関数, 三次関数...と∞に足し合わす事で元関数を表そうって事です！！！\\
便利そうですね. 計算はだるいが.\\
\subsection{指数関数と三角関数のマクローリン展開}
さて, ここで指数関数と三角関数(sin, cos)のマクローリン展開を見てみましょう！！\\

\begin{figure}[H]
\label{im:exp}
  \centering
  \includegraphics[width=120mm,bb=0 0 432 288]{figures/exp.png}
  \caption{exp関数のマクローリン展開}
\end{figure}
\begin{figure}[H]
\label{im:sine}
  \centering
  \includegraphics[width=120mm,bb=0 0 432 288]{figures/sine.png}
  \caption{sin関数のマクローリン展開}
\end{figure}

\begin{figure}[H]
\label{im:cosine}
  \centering
  \includegraphics[width=120mm,bb=0 0 432 288]{figures/cosine.png}
  \caption{cos関数のマクローリン展開}
\end{figure}

\begin{eqnarray}
\mathrm{e}^x = \sum_{(k=0)}^\infty \frac{x^k}{x!} = 1 + \frac{x}{1!} + \frac{x^2}{2!} + \frac{x^3}{3!} + ...
\label{eq:sisuu}
\end{eqnarray}

\begin{eqnarray}
\sin x = \sum_{k=0}^{\infty}(-1)^k \frac{x^{2k + 1}}{(2k + 1)!} = \frac{x}{1!} - \frac{x^3}{3!} + \frac{x^5}{5!} - \frac{x^7}{7!} +  ...
\label{eq:sain}
\end{eqnarray}

\begin{eqnarray}
\cos x = \sum_{k=0}^\infty(-1)^k \frac{x^{2k}}{(2k)!} = 1 - \frac{x^2}{2!} + \frac{x^4}{4!} - \frac{x^6}{6!} + ...
\label{eq:cosa}
\end{eqnarray}

賢い人なら気付くかもしれません！！！\\
気付きますよね？？\\
気付かないわけがありません.\\
なんとなくですが, 式(\ref{eq:sain})と式(\ref{eq:cosa})を足すと, 式(\ref{eq:sisuu})っぽいですよね！！\\
\\
え？違うじゃんって？\\
うるせえよ, だいたい一緒だろうが.\\
\\
\\
細かいやつは女の子に嫌われるんだぞ！この陰キャが！！\\
\\
陽キャの僕はとりあえず足してみます.
\\
\begin{eqnarray}
\mathrm{e}^x = \sum_{(k=0)}^\infty \frac{x^k}{x!} = 1 + \frac{x}{1!} + \frac{x^2}{2!} + \frac{x^3}{3!} + \frac{x^4}{4!} + ...
\end{eqnarray}
\begin{eqnarray}
\sin x + \cos x = 1 + \frac{x}{1!} - \frac{x^2}{2!} - \frac{x^3}{3!} + \frac{x^4}{4!} + ...
\label{eq:mix}
\end{eqnarray}

うーん, 惜しいですよね. もうちょっと, あとは符号だけ変えちゃえば大丈夫そうなのですが...\\
2項ずつ, 符号があってたりあってなかったりしてますね.\\
\\
これは一寸難しいですね. もし交互に異なるのであれば, 式(\ref{eq:mix})の構成要素のどちらかに -1 をかければ良いのですが, 2項ずつとなるとそうもいきません. かといって両方にマイナスをかけても, 違う形になるし...\\
\\
この段階で, 操作するべきは指数関数と, 三角関数のどちらかという指針がたちます.\\
\\
しかし, そのまま-1をかけても意味がない. そこで式に注目すると, 何乗もしています. なんとか乗した時に符号が変わればいいのですから, ここで虚数単位iの導入に目星をつけます.\\
\\
とりあえず指数の方にやってみましょう.
\begin{eqnarray}
\begin{split}
\mathrm{e}^{ix} \\
& = \sum_{(k=0)}^\infty \frac{ix^k}{x!} = 1 + \frac{ix}{1!} + \frac{i^2x^2}{2!} + \frac{i^3x^3}{3!} + \frac{i^4x^4}{4!} + ...\\
& = 1 + i\frac{x}{1!} - \frac{x^2}{2!} - \frac{ix^3}{3!} + \frac{x^4}{4!} + ...
\label{eq:eix}
\end{split}
\end{eqnarray}
ちょっといい感じですね.\\
次に, 分母が奇数の時にiが残ってしまっているので, 奇数に対応しているsinの方にもiをかけてみましょう！\\
\begin{eqnarray}
i\sin x = \sum_{k=0}^{\infty}(-1)^k \frac{x^{2k + 1}}{(2k + 1)!} = \frac{ix}{1!} - \frac{ix^3}{3!} + \frac{ix^5}{5!} - \frac{ix^7}{7!} +  ...
\end{eqnarray}
問題なさそうですね！改めてcosと足してみます！！\\
\begin{eqnarray}
\cos x + i\sin x = 1 + i\frac{x}{1!} - \frac{x^2}{2!} - \frac{ix^3}{3!} + \frac{x^4}{4!} + ...
\label{eq:cossin}
\end{eqnarray}
式(\ref{eq:eix})と式(\ref{eq:cossin})を見比べると, 見事に一致しています！！！\\
\\
これでオイラーの公式の証明がおわりですね！！\\
\\
オイラーの公式とは, 指数関数と三角関数をマクローリン展開した際にでてきた奴らが似ていたので, 虚数を導入してみたらきれいに等号で結べたねって事です.\\

\subsection{オイラーの公式の有用性}
オイラーの公式とは
\begin{eqnarray}
\mathrm{e}^{i\theta} = \cos \theta + i\sin \theta
\end{eqnarray}
であった.\\
\\
この時, Θにπを代入すると, 更に美しくなります.
\\
\begin{eqnarray}
\mathrm{e}^{i\pi} = -1 + 0\\
\mathrm{e}^{i\pi} + 1 = 0
\end{eqnarray}
実際に計算すれば分かりますね. たしかに成り立ちます. \\
最も基本である数字0と1, そしてネイピア数, 円周率, 虚数...\\
数学において偉大と言われる奴らが一堂に会して, あっさりとまとまっているのです！！！\\
ひええええ...！！！\\
\\
これこそが, オイラーの公式が人類の至宝といわれる所以ですね！\\
\\
\\
さて, オイラーの公式を信号処理の数学にどのように使っていくかというと, ざっくりした流れはこうだ！！！\\
\begin{itemize}
 \item 取得した関数を三角関数の和で表す
 \item 複素平面にもってきて極座標で表す
 \item 極座標を指数関数に変換する
 \item 計算がめっちゃ楽だし, 多次元のデータを取得できる
 \item 色々わかる！！うれしい！！
\end{itemize}
厳密に言うと脳波は定常性をもっていないので三角関数の和で表す事は出来ないんだが, 短時間の窓を設けたりウェーブレットを使う事によってそこは解決できる. \\
とりあえず今は, オイラーの公式を使う事によって脳波を簡単な形で表せる上にいろんな情報を読み取れるようになる！！すごい！！偉大だ！！！\\
\\
だけ分かればいい.\\
次節から実際にフーリエ変換などで使っていくので, オイラーの公式は脳にフィットさせといてください.\\

崇めよ！！！！！\\

\section{フーリエ変換}
さて, いよいよ本節から実際に我々が脳波と戦う際に用いる技の紹介となっていきます. 前章(\ref{basics})が理解できている諸君なら, それほどつまずく事もないはずです. 実際僕は, 前章に値する内容の理解と精査に非常に時間をかけましたが, これ以降はそれほど時間をかけずに理解を進める事が出来ました. 基本を忘れず臨んでください.
\subsection{脳波とは}
そもそも, 解析方法を考える以前に...\\
我々は脳波という似非科学チックな香ばしいものと対峙するわけですが, こいつの特性を知らずに武器や魔法を準備するのは非効率ですね. まずは脳波というものがどういったものなのかを考えてみます. \\
\\
脳波とは, 脳に無数に存在する脳神経細胞が刺激を受け, その総量が閾値を超えた時に発生される電気信号 ... の集合体の事です.\\
\\
領域Aに脳細胞が100万個あったとしましょう. \\
そのうち, 70万個が発火していて, 30万個が沈黙していたとします. 領域A直上にある脳波計の電極は, そこら一帯の電気的活動の総和を観測し, 領域Aで強い活動があったと記すわけです(図\ref{im:topo}).\\
\\
この時の「強い活動」というのは, 電極で計測された電気信号の振幅, 100万の細胞電位の総和の値です. これが大きい程, 強い活動という解釈がされます.\\

\begin{figure}[H]
\label{im:topo}
  \centering
  \includegraphics[width=120mm,bb=0 0 673 602]{figures/topomap.png}
  \caption{電極で拾われる脳波のイメージ. 近傍電位の総和}
\end{figure}

しかし, 元来神経細胞の1回の発火は一瞬のものです. 2つの細胞があったとして, それらが数ms間隔で交互に活動しているとしたら, 片方が発火している間にもう片方は負の方向に電位を発しているわけですから, その総和を取ると細胞1個の発火分にも満たない事になります. \\
これは当然, 数百万単位の細胞が集まった時にも同じ事が言えて, 振幅が小さいからといって脳が活動していない ... という訳ではありません. 単に同期的活動を行っているわけではないという事です.\\
\\
本来はパルス波っぽい挙動をする神経信号ですが, それらが無数に存在し, 各々のタイミングで活動をしているため, 脳波計の電極によって計測される信号は連続的で, 非常に複雑な挙動を取る波となります. \\
\\
この波を俗に脳波と言い, 振幅が大きい時には強い活動 (正確には同期した活動) が行われていて, 逆に振幅が小さい時には同期していない, つまり適当な活動を行っているといった解釈がなされたりします. \\
しかしこのままでは, 複雑すぎて人間の目で見たら何がどうなっているのか全く分からず, 麻酔科医やてんかんの診断をする超能力医者のようなスーパーマンでもない限り, 「これは○○の脳波だ！」とか言えません. そこで凡人の我々は, どうにかしてこの複雑怪奇な脳波を解釈し, 脳の活動を解明する必要があるわけです.\\

そこで, 最も基礎となるアプローチが...\\
複雑すぎて分からないなら, 単純な波に分解してあげればいいじゃん？？\\ 
というやつです. どんな波も, 直交性をもつ波に分解できるみたいな話題が前章にありましたよね？あれを利用します！！
\\
こうして, 複雑極まりない脳波を, 単純で解釈のしやすい三角関数の足し合わせとして表現しよう！というのがフーリエ変換のモチベーションです.\\

\begin{figure}[H]
\label{im:eeg}
  \centering
  \includegraphics[width=120mm,bb=0 0 600 313]{figures/eeg.jpg}
  \caption{A. 脳波の例 1 ～ 4は周波数帯成分}
\end{figure}

\subsection{フーリエ級数展開}
さて, フーリエ変換をする目的は, 複雑すぎて解釈できない時間関数を単純な関数によって表現する事で表現することでした.\\
\\
複雑な関数でも, 三角関数の足し合わせで表現できるという事は既に確認しましたね. 三角関数の特徴は, その振幅と角周波数が分かれば定義する事ができます. \\
角周波数とは, 1sの間にどれだけの角度波が進むかという指標で, 周波数とかから求める事が出来ます. まあ周波数って考えちゃっても大体おｋです. \\
\\
つまりフーリエ変換とは, 元関数を単純な三角関数に分け, それぞれの振幅を角周波数毎に求める事をさします.\\
\\
このうち, 元関数f(t)を単純な三角関数の足し合わせに分解するまでをフーリエ級数展開と言い, 式では以下のようになります. 
\begin{eqnarray}
f(t) = a_0 + \sum_{\omega=1}^\infty {(a_\omega \sin(\omega t) + b_\omega \cos(\omega t))}
\label{eq:fourierkyusu}
\end{eqnarray}
式(\ref{eq:fourierkyusu})の意味はこうです. 「元関数f(t)を, 1から無限の角周波数のsin, cos波の足し合わせとして表現する」 そのまんまですね！\\
\\
ここでのaやbは変数で, 実際にはそれぞれの項毎に異なる値を取ります. 要は振幅の事ですね.\\
\subsection{複素フーリエ級数}
しかし, 式(\ref{eq:fourierkyusu})は面倒ですね. なんていったってsinとcosを分けて計算するのがだるすぎます. どうにか綺麗にできないものか...\\
\\
え？オイラーの公式を使えばいいって？ ...天才かよ！！
\\
早速オイラーの公式を使って簡単にしてみましょう. 
\begin{eqnarray}
\mathrm{e}^{i\omega t} = \cos\omega t + i\sin\omega t
\label{eq:normaleuler}
\end{eqnarray}
いつもは$\pi$のところですが, 今回は空気を読んで角周波数$\omega t$に変形しています. しかし問題はあれです. オイラーの公式には愛がありますが, フーリエ級数展開の方には愛がありません. どうしたことか.\\
\\
オイラーの公式の裏を使います.
\begin{eqnarray}
\mathrm{e}^{-i\omega t} = \cos\omega t - i\sin\omega t
\label{eq:eulerminus}
\end{eqnarray}
式(\ref{eq:eulerminus})が成り立つのは大丈夫ですね？角度が実軸対称に飛んだら, cos成分は変わりませんがsin成分は符号が反転します. うちの猫でも知ってる事です.\\
\\
さて, 次に式(\ref{eq:normaleuler})と式(\ref{eq:eulerminus})を連立して解く事で式(\ref{eq:fourierkyusu})のcosとsinを置き換えます. \\
\begin{eqnarray}
f(t) = a_0 + \sum_{\omega=1}^\infty {(a_\omega \frac{\mathrm{e}^{i\omega t}+\mathrm{e}^{-i\omega t}}{2} + b_\omega \frac{\mathrm{e}^{i\omega t} - \mathrm{e}^{-i\omega t}}{2i})}
\label{eq:complexfourier}
\end{eqnarray}
この式を同類項を抜き出して整理すると
\begin{eqnarray}
f(t) = a_0 + \sum_{\omega=1}^\infty {(\frac{a_\omega - ib_\omega}{2}\mathrm{e}^{i\omega t})} + \sum_{\omega=1}^\infty {(\frac{a_\omega + ib\omega}{2}\mathrm{e}^{i\omega t})}
\label{eq:complexfourierkai}
\end{eqnarray}
となり, 更に$\mathrm{e}^{-i\omega t}$において$\omega$を1から$\infty$まで足すのと, $\mathrm{e}^{i\omega t}$において$-\infty$から-1まで足すのは同義なため(図を書けばわかる), この3項をうまくくっつける事で
\begin{eqnarray}
f(t) = \sum_{\omega = -\infty}^\infty F_\omega \mathrm{e}^{i\omega t}
\end{eqnarray}
とおけますね！いい感じにまとまりました！！！\\
あ, 定数部分は面倒なので$F_\omega$とおいてます. \\
\\
フーリエ変換では, この係数たちを求めます. 
\subsection{フーリエ変換} 
実際に式を見てみましょう.\\
\begin{eqnarray}
F(\omega) = \int_{-\infty}^{\infty} f(t)\mathrm{e}^{-i\omega t}
\label{eq:furier}
\end{eqnarray}

です. さっそく式(\ref{eq:furier})を解読してみましょう. 大丈夫. 基礎がしっかりできている人なら自ずと理解できるはずです.\\
\\
まず, eの肩に $ -i\omega t $ が載っていますね. この形はどこかで見た事があります. そう, オイラーの公式ですね！！\\
オイラーの公式にマイナスをかけたやつです. つまり $ \cos\omega t  - i\sin\omega t $ ですね. \\
式(\ref{eq:furier})は以下の式に変形できそうです.\\
\begin{eqnarray}
F(\omega) = \int_{-\infty}^{\infty} f(t)(\cos\omega t - i\sin\omega t)
\label{eq:furierkai}
\end{eqnarray}
おお、結構読めてきたんじゃないですかね.\\
分配法則が分からない輩のために, 更に式(\ref{eq:furierkai})を変形します.\\
\begin{eqnarray}
F(\omega) = \int_{-\infty}^{\infty} (f(t)\cos\omega t - f(t)i\sin\omega t)
\label{eq:furierkaikai}
\end{eqnarray}
もう完璧ですね. ここまで解してあげれば赤ちゃんでも噛み砕けそうです！！噛み砕けない人は乳歯が生えていないのでしょう. かわいそうに...\\
\\
さて, 式(\ref{eq:furierkaikai})を日本語にしてみましょうか.\\
まず, 時間(t)における元関数(ここでは, ある電極で取れた脳波ですね)と, 角周波数($\omega$)のcos, sin成分それぞれとの内積を取っています. 
\\
フーリエ変換において求めたい係数とは, 「元関数がその角周波数($\omega$)の三角関数に如何に似てるか」の指標です. そして関数の類似度の指標は内積で表せるんでしたね！！\\
\\
次に, sin成分が負($\mathrm{e}^{-i\omega t}$)になっている理由です. 内積とは「似ている度」の指標ですね. 普通の数字やベクトルでしたら正の値になりますが, 今回のように虚数や複素数の場合は内積の結果が複素数の形をとってしまう事になります.\\
それだと解釈に困りますね？どうにかして虚数成分は消えた感じの結果が欲しいわけです. 虚数成分を消す...共役複素数を使えばいいですね！！！\\
\\
これにより, ある角周波数成分 $\mathrm{e}^{i\omega t}$と元関数f(t)の内積を求める際に$\mathrm{e}^{-i\omega t}$を用いるわけです. まあ, やってるのは普通に内積です.\\
\\
\\
内積とは, 「どれだけ似ているか」の指標でしたね. つまりここで, 元関数は角周波数($\omega$)の三角関数とどれだけ似ているかを見ているわけです！！\\
そしてその結果を $-\infty$ から$\infty$ までの範囲で積分 ... 足し算しています.\\
この値がF($\omega$)らしいですね. さて, こいつはどういった条件でどういった値を取るかというと, 元関数の中に角周波数($\omega$)の成分が多ければ多い程, 内積の値は1に近くなります. という事はその総和も大きくなります. 逆に値が小さいという事は内積の値も小さい ... つまり元関数の中に角周波数($\omega$)の成分は少ないという事になりますね！！\\
\\
こうして, 複雑怪奇な時間関数を周波数関数に変換（というか見方を変える）事によって, より解釈のしやすい形に変換するのがフーリエ変換の強みです.\\
\\
\subsection{フーリエ変換の実用}
実際には, 式(\ref{eq:furier})によって無限の周波数成分を抜き出し, それぞれの振幅を求める事で, 元関数(t)はそれぞれの周波数をそれぞれの振幅倍したsin波の足し合わせで出来てるね！と解釈します.\\
例えば, 「タスク1をやらせた時の被験者君は5 -- 7Hzくらいの脳波がよくでているね！」「タスク2の時には大して強くないね。てことはタスク1と5 --7Hzの脳波には何か関係がありそうだね！！」といった具合です. 論文にもそのまんま書かれています.
\\
人はこれを周波数分解といい, これを使った解析が周波数解析だとかスペクトル解析と呼ばれる種々の解析になります！！（上の「」に入ってるのも周波数解析による解釈）
\section{wavelet 変換}
\subsection{フーリエ変換の弱点}
万能に思えるフーリエ変換ですが, 実は弱点があります.
\subsection{morlet wavelet}
\end{document}